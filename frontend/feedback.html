<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Feedback & Testimonials | Power Poly Supplies</title>
  <link rel="stylesheet" href="./css/styles.css"/>
  <link rel="icon" type="image/png" href="./assets/poly%20logo%20without%20background.png"/>
</head>
<body>
  <header class="site-header">
    <div class="promo-strip">
      <div class="container promo-inner">
        <div><strong data-i18n="brand.name">Power Poly Supplies</strong> | <span data-i18n="brand.tagline">Power your packaging</span></div>
        <div style="font-weight:700;" data-i18n="promo.right">Bulk-ready stock | Fast response | Canada-wide supply</div>
      </div>
    </div>
    <div class="navbar">
      <div class="container navbar-inner">
        <a class="brand" href="./index.html">
          <img src="./assets/poly%20logo%20without%20background.png" alt="Power Poly Supplies" width="62" height="62" decoding="async">
          <div class="brand-text">
            <span class="brand-title" data-i18n="brand.name">Power Poly Supplies</span>
            <span class="brand-tagline" data-i18n="brand.tagline">Power your packaging</span>
          </div>
        </a>
        <button class="menu-btn" id="menuBtn" aria-label="Open menu" data-i18n="nav.menu">Menu</button>
        <nav class="navlinks" id="navLinks">
          <a href="./index.html" data-i18n="nav.home">Home</a>
          <a href="./specials.html" data-i18n="nav.specials">Special Offers</a>
          <div class="dropdown">
            <button class="dropbtn" type="button"><span data-i18n="nav.shop">Shop by Category</span> <span class="caret" aria-hidden="true"></span></button>
            <div class="dropdown-menu">
              <a href="./products.html?cat=Garment%20Bags" data-i18n="nav.garment">Garment Cover Bags</a>
              <a href="./products.html?cat=Polybags" data-i18n="nav.polybags">Polybags</a>
              <a href="./products.html?cat=Hangers" data-i18n="nav.hangers">Hangers</a>
              <a href="./products.html?cat=Wraps" data-i18n="nav.wraps">Wraps</a>
              <a href="./products.html?cat=Racks" data-i18n="nav.racks">Racks</a>
            </div>
          </div>
          <a href="./about.html" data-i18n="nav.about">About Us</a>
          <a href="./contact.html"><span class="nav-icon phone-icon" aria-hidden="true"></span><span data-i18n="nav.contact">Contact</span></a>
          <a href="./feedback.html"><span class="nav-icon pen-icon" aria-hidden="true"></span><span data-i18n="nav.feedback">Feedback</span></a>
          <a href="./login.html"><span class="nav-icon user-icon" aria-hidden="true"></span><span data-i18n="nav.account">Account</span></a>
          <a href="./cart.html"><span class="nav-icon cart-icon" aria-hidden="true"></span><span data-i18n="nav.cart">Cart</span> <span class="badge" data-cart-badge>0</span></a>
          <form class="search-bar nav-search" action="./products.html" method="get" role="search">
            <input type="search" name="q" placeholder="Search" aria-label="Search products">
            <button type="submit">Search</button>
          </form>

        </nav>
      </div>
    </div>
  </header>

  <div class="container page">
    <section class="hero fade-in">
      <p style="margin:0; font-weight:700; letter-spacing:1px; text-transform:uppercase; color:var(--muted);" data-i18n="feedback.kicker">Feedback</p>
      <h1 data-i18n="feedback.title">What our customers say</h1>
      <p data-i18n="feedback.subtitle">Real experiences from dry cleaners, laundromats, and retailers who rely on Power Poly Supplies.</p>
    </section>

    <section class="testimonial-marquee fade-in">
      <div class="testimonial-track" id="testimonialGrid">
        <div class="testimonial-card">
          <div class="quote-mark">&ldquo;</div>
          <p class="testimonial-text"><span data-i18n="feedback.quote.one">Fast shipping, consistent quality, and responsive support. We keep coming back for garment covers and hangers.</span></p>
          <div class="testimonial-meta"><span data-i18n="feedback.quote.one.meta">Operations Manager - Toronto, ON</span></div>
        </div>
        <div class="testimonial-card">
          <div class="quote-mark">&ldquo;</div>
          <p class="testimonial-text"><span data-i18n="feedback.quote.two">Reliable stock and clear pricing. The team helped us choose the right sizes for bulk polybags.</span></p>
          <div class="testimonial-meta"><span data-i18n="feedback.quote.two.meta">Retail Owner - Vancouver, BC</span></div>
        </div>
        <div class="testimonial-card">
          <div class="quote-mark">&ldquo;</div>
          <p class="testimonial-text"><span data-i18n="feedback.quote.three">Square checkout was smooth and our order arrived on schedule. Great experience overall.</span></p>
          <div class="testimonial-meta"><span data-i18n="feedback.quote.three.meta">Laundry Service - Calgary, AB</span></div>
        </div>
        <div class="testimonial-card">
          <div class="quote-mark">&ldquo;</div>
          <p class="testimonial-text"><span data-i18n="feedback.quote.four">Support replies quickly and they always have the hangers we need. Highly recommend.</span></p>
          <div class="testimonial-meta"><span data-i18n="feedback.quote.four.meta">Dry Cleaner - Halifax, NS</span></div>
        </div>
        <div class="testimonial-card en-only">
          <div class="quote-mark">&ldquo;</div>
          <p class="testimonial-text">Great quality polybags and quick fulfillment. The team helped us restock on short notice.</p>
          <div class="testimonial-meta">Retail Owner - Scarborough, ON</div>
        </div>
        <div class="testimonial-card en-only">
          <div class="quote-mark">&ldquo;</div>
          <p class="testimonial-text">Bulk pricing is transparent and delivery is always on time. Easy to reorder.</p>
          <div class="testimonial-meta">Laundry Service - Toronto, ON</div>
        </div>
        <div class="testimonial-card en-only">
          <div class="quote-mark">&ldquo;</div>
          <p class="testimonial-text">We switched suppliers and have been happy with the stock consistency and support.</p>
          <div class="testimonial-meta">Dry Cleaner - Barrie, ON</div>
        </div>
        <div class="testimonial-card en-only">
          <div class="quote-mark">&ldquo;</div>
          <p class="testimonial-text">Fast replies and dependable packaging supplies. Our monthly orders are smoother now.</p>
          <div class="testimonial-meta">Operations Manager - Markham, ON</div>
        </div>
        <div class="testimonial-card en-only">
          <div class="quote-mark">&ldquo;</div>
          <p class="testimonial-text">Reliable hangers and garment bags with clear pricing. No surprises, just good service.</p>
          <div class="testimonial-meta">Retail Owner - Brampton, ON</div>
        </div>
        <div class="testimonial-card en-only">
          <div class="quote-mark">&ldquo;</div>
          <p class="testimonial-text">Orders arrive quickly and the catalog is easy to browse. Quality stays consistent.</p>
          <div class="testimonial-meta">Dry Cleaner - Pickering, ON</div>
        </div>
        <div class="testimonial-card en-only">
          <div class="quote-mark">&ldquo;</div>
          <p class="testimonial-text">Customer service is responsive and inventory is dependable week after week.</p>
          <div class="testimonial-meta">Laundry Service - Kipling, ON</div>
        </div>
        <div class="testimonial-card en-only">
          <div class="quote-mark">&ldquo;</div>
          <p class="testimonial-text">Great variety of wraps and polybags. The team makes bulk ordering simple.</p>
          <div class="testimonial-meta">Warehouse Manager - Mississauga, ON</div>
        </div>
        <div class="testimonial-card en-only">
          <div class="quote-mark">&ldquo;</div>
          <p class="testimonial-text">Consistent stock and fast turnaround. We rely on them for all our packaging needs.</p>
          <div class="testimonial-meta">Retail Owner - Vaughan, ON</div>
        </div>
        <div class="testimonial-card en-only">
          <div class="quote-mark">&ldquo;</div>
          <p class="testimonial-text">Smooth ordering and accurate deliveries every time. Excellent for busy seasons.</p>
          <div class="testimonial-meta">Operations Manager - North York, ON</div>
        </div>
      </div>
    </section>

    <section class="card fade-in" style="padding:18px; margin-top:18px;">
      <h2 style="margin:0 0 8px;" data-i18n="feedback.form.title">Share your feedback</h2>
      <p style="margin:0 0 12px; color:var(--muted);"><span data-i18n="feedback.form.desc">Tell us how we're doing - products, service, delivery. Your feedback helps us improve.</span></p>
      <form class="grid" id="feedbackForm" style="gap:10px; max-width:720px;">
        <input class="input" id="feedbackName" type="text" placeholder="Your name (optional)" data-i18n-placeholder="feedback.form.name">
        <input class="input" id="feedbackEmail" type="email" placeholder="Email (optional)" data-i18n-placeholder="feedback.form.email">
        <div class="rating-row">
          <label for="feedbackRating" data-i18n="feedback.form.rating.label">Rating (optional)</label>
          <select class="input" id="feedbackRating">
            <option value="" data-i18n="feedback.form.rating.placeholder">Select rating</option>
            <option value="5" data-i18n="feedback.form.rating.5">5 - Excellent</option>
            <option value="4" data-i18n="feedback.form.rating.4">4 - Great</option>
            <option value="3" data-i18n="feedback.form.rating.3">3 - Good</option>
            <option value="2" data-i18n="feedback.form.rating.2">2 - Fair</option>
            <option value="1" data-i18n="feedback.form.rating.1">1 - Poor</option>
          </select>
        </div>
        <textarea class="input" id="feedbackMessage" placeholder="Your feedback..." data-i18n-placeholder="feedback.form.message" style="min-height:120px;"></textarea>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <button class="btn btn-primary" type="submit" id="feedbackSubmit" data-i18n="feedback.form.submit">Submit feedback</button>
          <button class="btn btn-outline" type="button" id="feedbackEmailBtn" data-i18n="feedback.form.email_btn">Email us directly</button>
        </div>
        <div id="feedbackStatus" class="status muted" style="display:none;"></div>
        <div style="font-size:13px; color:var(--muted);" data-i18n="feedback.form.note">For order issues, include your order ID so we can help faster.</div>
      </form>
    </section>

    <div class="footer">&copy; <span id="y"></span> Power Poly Supplies. Power your packaging.</div>
  </div>

  <script src="./config.js"></script>

  <script src="./js/store.js"></script>
  <script src="./js/i18n.js"></script>
  <script src="./js/ui.js"></script>
  <script>
    document.getElementById("y").textContent = new Date().getFullYear();
    PPS.updateCartBadge();

    const feedbackForm = document.getElementById("feedbackForm");
    const feedbackName = document.getElementById("feedbackName");
    const feedbackEmail = document.getElementById("feedbackEmail");
    const feedbackRating = document.getElementById("feedbackRating");
    const feedbackMessage = document.getElementById("feedbackMessage");
    const feedbackStatus = document.getElementById("feedbackStatus");
    const feedbackSubmit = document.getElementById("feedbackSubmit");
    const feedbackEmailBtn = document.getElementById("feedbackEmailBtn");

    function setFeedbackStatus(text, type){
      feedbackStatus.textContent = text;
      feedbackStatus.className = `status ${type || "muted"}`;
      feedbackStatus.style.display = "block";
    }

    async function sendFeedback(){
      const payload = {
        name: feedbackName.value.trim(),
        email: feedbackEmail.value.trim(),
        rating: feedbackRating.value ? Number(feedbackRating.value) : undefined,
        message: feedbackMessage.value.trim()
      };

      if(!payload.message){
        setFeedbackStatus(window.PPS_I18N?.t("feedback.status.missing") || "Please add your feedback message first.", "error");
        feedbackMessage.classList.add("error");
        return;
      }

      feedbackMessage.classList.remove("error");
      feedbackSubmit.disabled = true;
      feedbackEmailBtn.disabled = true;
      setFeedbackStatus(window.PPS_I18N?.t("feedback.status.sending") || "Sending your feedback...", "muted");

      try{
        const res = await fetch(`${PPS.API_BASE}/api/feedback`, {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });
        const data = await res.json().catch(()=> ({}));
        if(!res.ok || !data.ok){
          throw new Error(data?.message || (window.PPS_I18N?.t("feedback.status.failed") || "Failed to send feedback."));
        }

        feedbackMessage.value = "";
        feedbackRating.value = "";
        const note = data.emailSent ? (window.PPS_I18N?.t("feedback.status.copy") || "We also emailed a copy to our team.") : (window.PPS_I18N?.t("feedback.status.review") || "We'll review it shortly.");
        const thanks = window.PPS_I18N?.t("feedback.status.thanks") || "Thanks! Your feedback was received.";
        setFeedbackStatus(`${thanks} ${note}`, "success");
      }catch(err){
        setFeedbackStatus(err.message || (window.PPS_I18N?.t("feedback.status.failed") || "Failed to send feedback."), "error");
      }finally{
        feedbackSubmit.disabled = false;
        feedbackEmailBtn.disabled = false;
      }
    }

    feedbackForm.addEventListener("submit", (event)=>{
      event.preventDefault();
      sendFeedback();
    });

    feedbackEmailBtn.addEventListener("click", ()=>{
      sendFeedback();
    });

    function setupMarquee(){
      const track = document.getElementById("testimonialGrid");
      if(!track || track.dataset.cloned === "true") return;
      const cards = Array.from(track.children);
      if(!cards.length) return;
      cards.forEach((card)=> track.appendChild(card.cloneNode(true)));
      track.dataset.cloned = "true";
      requestAnimationFrame(()=>{
        const total = track.scrollWidth / 2;
        const duration = Math.max(24, total / 70);
        track.style.setProperty("--marquee-duration", `${duration}s`);
      });
    }

    function pruneTestimonialsForLang(){
      const lang = window.PPS_I18N?.getLang?.() || "en";
      if(lang === "en") return;
      document.querySelectorAll(".testimonial-card.en-only").forEach(el => el.remove());
    }

    function escapeHtml(value){
      return String(value ?? "")
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/\"/g, "&quot;")
        .replace(/'/g, "&#39;");
    }

    function renderStars(rating){
      const count = Math.max(0, Math.min(5, Number(rating) || 0));
      return "\u2605".repeat(count) + "\u2606".repeat(5 - count);
    }

    function liveCustomerLabel(){
      const lang = window.PPS_I18N?.getLang?.() || "en";
      if(lang === "fr") return "Client";
      if(lang === "ko") return "고객";
      if(lang === "hi") return "ग्राहक";
      if(lang === "ta") return "வாடிக்கையாளர்";
      return "Customer";
    }

    function liveRatingAria(rating){
      const lang = window.PPS_I18N?.getLang?.() || "en";
      const value = String(Math.max(0, Math.min(5, Number(rating) || 0)));
      if(lang === "fr") return `Note ${value} sur 5`;
      if(lang === "ko") return `평점 5점 만점에 ${value}점`;
      if(lang === "hi") return `5 में से ${value} रेटिंग`;
      if(lang === "ta") return `5 இல் ${value} மதிப்பீடு`;
      return `Rating ${value} out of 5`;
    }

    function localizeRatingSelect(){
      const lang = window.PPS_I18N?.getLang?.() || "en";
      const label = document.querySelector("label[for='feedbackRating']");
      const select = document.getElementById("feedbackRating");
      if(!label || !select) return;
      const sets = {
        en: { label:"Rating (optional)", placeholder:"Select rating", r5:"5 - Excellent", r4:"4 - Great", r3:"3 - Good", r2:"2 - Fair", r1:"1 - Poor" },
        fr: { label:"Note (optionnel)", placeholder:"Choisir une note", r5:"5 - Excellent", r4:"4 - Très bien", r3:"3 - Bien", r2:"2 - Passable", r1:"1 - Mauvais" },
        ko: { label:"평점(선택 사항)", placeholder:"평점 선택", r5:"5 - 최고", r4:"4 - 아주 좋음", r3:"3 - 좋음", r2:"2 - 보통", r1:"1 - 나쁨" },
        hi: { label:"रेटिंग (वैकल्पिक)", placeholder:"रेटिंग चुनें", r5:"5 - उत्कृष्ट", r4:"4 - बहुत अच्छा", r3:"3 - अच्छा", r2:"2 - ठीक", r1:"1 - खराब" },
        ta: { label:"மதிப்பீடு (விருப்பம்)", placeholder:"மதிப்பீடு தேர்வு", r5:"5 - மிகச் சிறந்தது", r4:"4 - மிக நன்று", r3:"3 - நன்று", r2:"2 - சரி", r1:"1 - மோசம்" }
      };
      const dict = sets[lang] || sets.en;
      label.textContent = dict.label;
      const options = Array.from(select.options);
      const find = (value)=> options.find(o => o.value === value);
      const o0 = find("") || options[0];
      if(o0) o0.textContent = dict.placeholder;
      const o5 = find("5"); if(o5) o5.textContent = dict.r5;
      const o4 = find("4"); if(o4) o4.textContent = dict.r4;
      const o3 = find("3"); if(o3) o3.textContent = dict.r3;
      const o2 = find("2"); if(o2) o2.textContent = dict.r2;
      const o1 = find("1"); if(o1) o1.textContent = dict.r1;
    }

    async function loadLiveFeedback(){
      const grid = document.getElementById("testimonialGrid");
      if(!grid) return;
      try{
        const res = await fetch(`${PPS.API_BASE}/api/feedback/public?limit=12`);
        const data = await res.json();
        if(!res.ok || !data.ok || !Array.isArray(data.feedback)) return;

        const items = data.feedback
          .filter(item => item && item.message && item.message.length >= 40)
          .map(item => ({
            ...item,
            rating: Number(item.rating) || 0,
            score: (Number(item.rating) || 0) * 100 + Math.min(item.message.length, 300)
          }))
          .sort((a,b)=> b.score - a.score)
          .slice(0, 6);

        if(!items.length) return;

        const liveCards = items.map((item)=>{
          const fallbackName = liveCustomerLabel();
          const safeName = escapeHtml(String(item.name || fallbackName).trim() || fallbackName);
          const safeMsg = escapeHtml(String(item.message || "").trim());
          const ariaLabel = liveRatingAria(item.rating || 0);
          const stars = item.rating
            ? `<div class="testimonial-rating" aria-label="${escapeHtml(ariaLabel)}">${renderStars(item.rating)}</div>`
            : "";
          return `
            <div class="testimonial-card live">
              <div class="quote-mark">&ldquo;</div>
              ${stars}
              <p class="testimonial-text">${safeMsg}</p>
              <div class="testimonial-meta">${safeName}</div>
            </div>
          `;
        }).join("");

        grid.insertAdjacentHTML("afterbegin", liveCards);
      }catch(err){
        // ignore
      }
    }

    pruneTestimonialsForLang();
    localizeRatingSelect();
    loadLiveFeedback().finally(setupMarquee);
  </script>
</body>
</html>
