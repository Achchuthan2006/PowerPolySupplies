(()=>{"use strict";const i=(e,t)=>{try{return window.PPS_I18N?.t?.(e)||t}catch{return t}},A=e=>String(e||"").replace(/\s+/g," ").trim().split(" ").filter(Boolean).length,k=e=>Math.max(1,Math.round((Number(e)||0)/220)),S=e=>i("blog.read_time","{{min}} min read").replace("{{min}}",String(e)),w=e=>String(e||"").split("\xE2\u20AC\xA2").join("\xB7").split(/[Â·\u2022]/g).map(t=>t.trim()).filter(Boolean),C=e=>{const t=new URL(window.location.href);return t.hash=e?`#${e}`:"",t.toString()},T=async e=>{try{if(navigator.clipboard?.writeText)return await navigator.clipboard.writeText(e),!0}catch{}try{return window.prompt(i("blog.share.copy_prompt","Copy this link:"),e),!0}catch{return!1}};function $({url:e,title:t}){const o=document.createElement("div");o.className="blog-share-bar";const n=i("blog.share","Share"),a=i("blog.share.copy","Copy link"),c=i("blog.share.copied","Copied!"),l=i("blog.share.email","Email"),s=i("blog.share.linkedin","LinkedIn"),m=i("blog.share.x","X"),r=encodeURIComponent(e),d=encodeURIComponent(t||""),u=`mailto:?subject=${d}&body=${r}`,b=`https://www.linkedin.com/sharing/share-offsite/?url=${r}`,f=`https://twitter.com/intent/tweet?url=${r}&text=${d}`;o.innerHTML=`
      <div class="blog-share-title">${n}</div>
      <div class="blog-share-actions">
        <button class="btn btn-primary btn-sm" type="button" data-share="copy">${a}</button>
        <button class="btn btn-outline btn-sm" type="button" data-share="native" style="display:none;">${n}</button>
        <a class="btn btn-outline btn-sm" target="_blank" rel="noopener" href="${f}">${m}</a>
        <a class="btn btn-outline btn-sm" target="_blank" rel="noopener" href="${b}">${s}</a>
        <a class="btn btn-outline btn-sm" href="${u}">${l}</a>
      </div>
    `;const g=o.querySelector('[data-share="copy"]'),h=o.querySelector('[data-share="native"]');return navigator.share&&(h.style.display="",h.addEventListener("click",async()=>{try{await navigator.share({title:t||"",text:t||"",url:e})}catch{}})),g.addEventListener("click",async()=>{if(!await T(e))return;const p=g.textContent;g.textContent=c,g.classList.add("is-copied"),setTimeout(()=>{g.textContent=p,g.classList.remove("is-copied")},1400)}),o}function q(){return Array.from(document.querySelectorAll("article.blog-post[id]")).map(t=>{const o=String(t.id||""),n=(t.querySelector("h2")?.textContent||"").trim(),a=String(t.dataset.cat||"").trim().toLowerCase(),c=(t.querySelector(".blog-post-meta")?.textContent||"").trim(),l=w(c)[0]||"",s=(t.querySelector(".blog-post-sub")?.textContent||"").trim(),m=t.querySelector("img"),r=m?.getAttribute?.("src")||"",d=m?.getAttribute?.("alt")||"";return{id:o,title:n,cat:a,el:t}}).map((t,o)=>{const n=(t.el.querySelector(".blog-post-meta")?.textContent||"").trim(),a=w(n)[0]||"",c=(t.el.querySelector(".blog-post-sub")?.textContent||"").trim(),l=t.el.querySelector("img"),s=l?.getAttribute?.("src")||"",m=l?.getAttribute?.("alt")||"";return{...t,idx:o,dateLabel:a,excerpt:c,coverSrc:s,coverAlt:m}}).filter(t=>t.id)}function V(e){return String(e?.dataset?.cat||"").trim().toLowerCase()}function _(e){const t=new Map(e.map(o=>[o.id,o]));e.forEach(o=>{const n=o.el.querySelector(".blog-post-meta");if(!n)return;const a=o.el.textContent||"",c=A(a),l=k(c),s=S(l),m=String(n.textContent||""),r=w(m)[0]||m.trim();n.textContent=r?`${r} \xB7 ${s}`:s,o.el.dataset.readMin=String(l)}),document.querySelectorAll('.blog-card[href^="#"], .blog-card[href^="./blog.html#"]').forEach(o=>{const n=o.getAttribute("href")||"",a=n.includes("#")?n.split("#").pop():"",c=t.get(String(a||""));if(!c)return;const l=S(c.el.dataset.readMin||"1");let s=o.querySelector(".blog-card-meta");s||(s=document.createElement("div"),s.className="blog-card-meta",o.appendChild(s)),s.textContent=l})}const M=e=>{const t=String(e||"").trim().toLowerCase(),n={news:"blog.filter.news",launch:"blog.filter.launch",case:"blog.filter.case",tips:"blog.filter.tips"}[t]||"";return n?i(n,t.toUpperCase()):t?t.toUpperCase():i("blog.related.kicker","POST")};function P(e){e.forEach(t=>{const o=C(t.id),n=t.title||document.title,a=t.el.querySelector(".blog-post-head");if(a&&!t.el.querySelector(".blog-share-bar")){const c=$({url:o,title:n});a.insertAdjacentElement("afterend",c)}})}function N(e){e.forEach(t=>{if(t.el.querySelector(".blog-share-bar.bottom"))return;const o=C(t.id),n=t.title||document.title,a=$({url:o,title:n});a.classList.add("bottom"),t.el.appendChild(a)})}function B(e){const t=new Map;e.forEach(n=>{const a=n.cat||"all";t.has(a)||t.set(a,[]),t.get(a).push(n)});const o=i("blog.related.title","Related posts");e.forEach(n=>{if(n.el.querySelector(".blog-related"))return;const a=(t.get(n.cat||"all")||[]).filter(r=>r.id!==n.id),c=e.filter(r=>r.id!==n.id&&r.cat!==n.cat),l=[...a,...c].slice(0,3);if(!l.length)return;const s=document.createElement("div");s.className="blog-related",s.innerHTML=`
        <div class="blog-related-title">${o}</div>
        <div class="blog-related-grid"></div>
      `;const m=s.querySelector(".blog-related-grid");l.forEach(r=>{const d=document.createElement("a");d.className="blog-related-card",d.href=`#${r.id}`,d.setAttribute("data-cat",r.cat||""),d.innerHTML=`
          <div class="blog-related-kicker">${M(r.cat)}</div>
          <div class="blog-related-name">${r.title||""}</div>
          <div class="blog-related-meta">${S(r.el.dataset.readMin||"1")}</div>
        `,m.appendChild(d)}),n.el.appendChild(s)})}function I(e){const t=document.getElementById("blogFeatured");if(!t)return;const o=e[0];if(!o)return;const n=i("blog.featured.kicker","Featured"),a=i("blog.featured.cta","Read article"),c=`#${o.id}`,l=o.coverSrc||"./assets/polybag%20clear.webp",s=o.coverAlt||"";t.innerHTML=`
      <div class="blog-featured-grid">
        <div class="blog-featured-body">
          <div class="blog-featured-kicker">${n}</div>
          <div class="blog-featured-title">${o.title||""}</div>
          <div class="blog-featured-meta">${[o.dateLabel,S(o.el?.dataset?.readMin||"1")].filter(Boolean).join(" \xB7 ")}</div>
          <div class="blog-featured-desc">${o.excerpt||""}</div>
          <div class="blog-featured-actions">
            <a class="btn btn-primary btn-sm" href="${c}">${a}</a>
            <a class="btn btn-outline btn-sm" href="./products.html">${i("industry.cta.browse","Browse products")}</a>
          </div>
        </div>
        <div class="blog-featured-media" aria-hidden="true">
          <img src="${l}" alt="${String(s).replace(/\"/g,"&quot;")}" loading="lazy" decoding="async">
        </div>
      </div>
    `}function R(e){const t=new Map(e.map(n=>[n.id,n]));Array.from(document.querySelectorAll('.blog-card[href*="#"]')).forEach(n=>{if(n.querySelector(".blog-card-thumb"))return;const a=n.getAttribute("href")||"",c=a.includes("#")?a.split("#").pop():"",l=t.get(String(c||""));if(!l)return;const s=l.coverSrc||"";if(s){const u=document.createElement("div");u.className="blog-card-thumb",u.innerHTML=`<img src="${s}" alt="" loading="lazy" decoding="async">`,n.insertAdjacentElement("afterbegin",u)}const m=l.el?.dataset?.readMin||"1",r=[l.dateLabel,S(m)].filter(Boolean).join(" \xB7 ");let d=n.querySelector(".blog-card-meta");d||(d=document.createElement("div"),d.className="blog-card-meta",n.appendChild(d)),d.textContent=r})}function U(e){const t=Array.from(document.querySelectorAll(".blog-filter")),o=document.getElementById("blogSearch"),n=document.getElementById("blogResults"),a=Array.from(document.querySelectorAll(".blog-card"));if(!t.length||!a.length)return;const c=()=>String(document.querySelector(".blog-filter.active")?.dataset?.filter||"all"),l=r=>{const d=String(r||"all").trim()||"all";t.forEach(u=>u.classList.toggle("active",u.dataset.filter===d))},s=()=>{const r=c(),d=String(o?.value||"").trim().toLowerCase();let u=0;if(a.forEach(b=>{const f=String(b.dataset.cat||""),g=r==="all"||f===r;if(!d){b.style.display=g?"":"none",g&&(u+=1);return}const E=(b.textContent||"").toLowerCase().includes(d),p=g&&E;b.style.display=p?"":"none",p&&(u+=1)}),n){const b=i("blog.results","{{count}} posts");n.textContent=b.replace("{{count}}",String(u))}try{const b=new URL(window.location.href),f=c();f&&f!=="all"?b.searchParams.set("cat",f):b.searchParams.delete("cat"),window.history.replaceState({},"",b.toString())}catch{}},m=a.reduce((r,d)=>{const u=String(d.dataset.cat||"");return r.all=(r.all||0)+1,u&&(r[u]=(r[u]||0)+1),r},{});t.forEach(r=>{const d=String(r.dataset.filter||"all"),u=Number(m[d]||0);let b=r.querySelector(".blog-filter-count");b||(b=document.createElement("span"),b.className="blog-filter-count",r.appendChild(b));const f=i("blog.filter.count","({{count}})");b.textContent=` ${f.replace("{{count}}",String(u))}`});try{const r=new URLSearchParams(window.location.search),d=String(r.get("cat")||"").trim();["news","launch","case","tips"].includes(d)?l(d):l("all")}catch{l("all")}if(t.forEach(r=>{r.addEventListener("click",()=>{l(r.dataset.filter||"all"),s()})}),o){let r=null;o.addEventListener("input",()=>{clearTimeout(r),r=setTimeout(s,120)})}s()}function H(e){const t=i("blog.toc.title","On this page");e.forEach(o=>{if(o.el.querySelector(".blog-toc"))return;const n=Array.from(o.el.querySelectorAll("h3")).filter(s=>(s.textContent||"").trim());if(n.length<2)return;n.forEach((s,m)=>{if(s.id)return;const r=`${o.id}-h${m+1}`;s.id=r});const a=document.createElement("div");a.className="blog-toc",a.innerHTML=`
        <div class="blog-toc-title">${t}</div>
        <div class="blog-toc-links"></div>
      `;const c=a.querySelector(".blog-toc-links");n.forEach(s=>{const m=document.createElement("a");m.className="blog-toc-link",m.href=`#${s.id}`,m.textContent=(s.textContent||"").trim(),c.appendChild(m)});const l=o.el.querySelector(".blog-share-bar")||o.el.querySelector(".blog-post-head");l&&l.insertAdjacentElement("afterend",a)})}function j(e){e.forEach((t,o)=>{if(t.el.querySelector(".blog-nextprev"))return;const n=e[o-1],a=e[o+1];if(!n&&!a)return;const c=document.createElement("div");c.className="blog-nextprev",c.innerHTML=`
        <a class="blog-nextprev-link" href="${n?`#${n.id}`:"#"}" style="${n?"":"visibility:hidden;"}">
          <div class="blog-nextprev-kicker">${i("blog.nav.prev","Previous")}</div>
          <div class="blog-nextprev-title">${n&&n.title||""}</div>
        </a>
        <a class="blog-nextprev-link" href="${a?`#${a.id}`:"#"}" style="${a?"":"visibility:hidden;"}">
          <div class="blog-nextprev-kicker">${i("blog.nav.next","Next")}</div>
          <div class="blog-nextprev-title">${a&&a.title||""}</div>
        </a>
      `,t.el.appendChild(c)})}function O(e,t){const o=i("blog.comments.empty","No comments yet. Be the first to share a tip.");if(!Array.isArray(t)||t.length===0){e.innerHTML=`<div class="blog-comments-empty">${o}</div>`;return}e.innerHTML=t.slice().sort((n,a)=>Number(n?.at||0)-Number(a?.at||0)).map(n=>{const a=String(n?.name||i("blog.comments.anonymous","Anonymous")).trim(),c=new Date(Number(n?.at||Date.now())),l=Number.isNaN(c.getTime())?"":c.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric"}),m=String(n?.message||"").trim().replace(/</g,"&lt;").replace(/>/g,"&gt;");return`
          <div class="blog-comment">
            <div class="blog-comment-head">
              <div class="blog-comment-name">${a.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</div>
              <div class="blog-comment-date">${l}</div>
            </div>
            <div class="blog-comment-body">${m.replace(/\n/g,"<br/>")}</div>
          </div>
        `}).join("")}function D(e){const t=i("blog.comments.title","Comments"),o=i("blog.comments.note","Comments are stored on your device (local only)."),n=i("blog.comments.name","Name"),a=i("blog.comments.email","Email (optional)"),c=i("blog.comments.message","Write a comment..."),l=i("blog.comments.post","Post comment"),s=i("blog.comments.invalid","Please write a comment."),m=i("blog.comments.saved","Comment posted.");e.forEach(r=>{if(r.el.querySelector(".blog-comments"))return;const d=`pps_blog_comments_v1_${r.id}`,u=document.createElement("div");u.className="blog-comments",u.innerHTML=`
        <div class="blog-comments-title">${t}</div>
        <div class="blog-comments-note">${o}</div>
        <div class="blog-comments-list" data-list></div>
        <form class="blog-comments-form" data-form>
          <div class="blog-comments-row">
            <label class="blog-comments-label">
              <span>${n}</span>
              <input class="input" name="name" autocomplete="name" />
            </label>
            <label class="blog-comments-label">
              <span>${a}</span>
              <input class="input" type="email" name="email" autocomplete="email" />
            </label>
          </div>
          <label class="blog-comments-label">
            <span style="display:none;">${c}</span>
            <textarea class="input" name="message" rows="3" placeholder="${c}"></textarea>
          </label>
          <div class="blog-comments-actions">
            <button class="btn btn-primary btn-sm" type="submit">${l}</button>
            <div class="blog-comments-status" data-status role="status" aria-live="polite"></div>
          </div>
        </form>
      `;const b=u.querySelector("[data-list]"),f=u.querySelector("[data-form]"),g=u.querySelector("[data-status]"),h=()=>{try{const y=localStorage.getItem(d),v=y?JSON.parse(y):[];return Array.isArray(v)?v:[]}catch{return[]}},E=y=>{try{return localStorage.setItem(d,JSON.stringify(y||[])),!0}catch{return!1}},p=()=>O(b,h());p(),f.addEventListener("submit",y=>{y.preventDefault(),g.textContent="";const v=new FormData(f),x=String(v.get("message")||"").trim();if(!x){g.textContent=s;return}const X=String(v.get("name")||"").trim(),z=String(v.get("email")||"").trim(),L=h();if(L.push({at:Date.now(),name:X,email:z,message:x}),!E(L)){g.textContent=i("blog.comments.storage_failed","Could not save comment on this device.");return}try{f.reset()}catch{}p(),g.textContent=m}),r.el.appendChild(u)})}async function F(e){const t={name:"",email:e,phone:"",orderType:"blog_subscribe",message:`Please subscribe this email to blog updates: ${e}`},o=window.PPS?.API_BASE||window.API_BASE_URL||window.PPS_API_BASE||"";if(!o)throw new Error("missing_api_base");const n=await fetch(`${o.replace(/\/+$/,"")}/api/contact`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await n.json().catch(()=>({}));if(!n.ok||!a?.ok)throw new Error(a?.message||"subscribe_failed");return!0}function J(){const e=document.getElementById("blogSubscribeForm");if(!e)return;const t=document.getElementById("blogSubscribeStatus"),o=e.querySelector('input[name="email"]'),n=i("blog.subscribe.sending","Subscribing..."),a=i("blog.subscribe.thanks","Thanks! You're subscribed."),c=i("blog.subscribe.failed","Couldn't subscribe right now. Try again or email us.");e.addEventListener("submit",async l=>{l.preventDefault(),t&&(t.textContent="");const s=String(o?.value||"").trim();if(!s||!s.includes("@")){t&&(t.textContent=i("blog.subscribe.invalid","Enter a valid email."));return}t&&(t.textContent=n);try{await F(s);try{localStorage.setItem("pps_blog_subscribed_email",s)}catch{}t&&(t.textContent=a);return}catch{try{const m=encodeURIComponent("Blog updates subscription"),r=encodeURIComponent(`Please add me to blog updates: ${s}`);window.location.href=`mailto:powerpolysupplies@gmail.com?subject=${m}&body=${r}`}catch{}t&&(t.textContent=c)}});try{const l=localStorage.getItem("pps_blog_subscribed_email");l&&o&&!o.value&&(o.value=l)}catch{}}function W(){const e=q();e.length&&(_(e),R(e),I(e),U(e),P(e),H(e),B(e),D(e),j(e),N(e),J())}window.addEventListener("DOMContentLoaded",W)})();
